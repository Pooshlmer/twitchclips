(this.webpackJsonptwitchclips=this.webpackJsonptwitchclips||[]).push([[0],{15:function(e,t,a){e.exports=a(45)},20:function(e,t,a){},41:function(e,t,a){},45:function(e,t,a){"use strict";a.r(t);var l=a(0),s=a.n(l),i=a(14),n=a.n(i),r=(a(20),a(4)),o=a.n(r),c=a(47),h=a(3),u=a.n(h);const d="localhost"===window.location.hostname?"http://localhost:3000/twitchclips/":window.location.href.split("#")[0];class p{constructor(e){this.NUMBER_OF_FOLLOWS=100,this.CLIPS_PER_FOLLOW=10,this.authtoken=e,u.a.defaults.headers.common.Authorization="Bearer "+e,u.a.defaults.headers.common["Client-ID"]="iscuhj0tftkxkrcmwcw4slvjj4k9m3"}async getAllClips(e,t){if(console.log(t),null===this.authtoken)return null;let a=new Date,l=new Date;l.setDate(l.getDate()-t);let s=[];for(let i of e){let e;e=0!==t?{broadcaster_id:i.broadcaster_id,started_at:l.toISOString(),ended_at:a.toISOString(),first:this.CLIPS_PER_FOLLOW}:{broadcaster_id:i.broadcaster_id,first:this.CLIPS_PER_FOLLOW};let n={params:e};s.push(u.a.get("https://api.twitch.tv/helix/clips",n))}return Promise.allSettled(s)}async getUser(){return u.a.get("https://api.twitch.tv/helix/users")}async getFollows(e){let t={params:{user_id:e,first:this.NUMBER_OF_FOLLOWS}};return u.a.get("https://api.twitch.tv/helix/channels/followed",t)}async getToken(){return this.authtoken}static getLoginLink(){let e=this.TWITCH_LOGIN_LINK,t=Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15),a={client_id:"iscuhj0tftkxkrcmwcw4slvjj4k9m3",redirect_uri:this.LOCALREDIRECT,response_type:"token",scope:"user:read:email user:read:follows",state:t};sessionStorage.setItem("state",t);let l=o.a.stringify(a);return console.log("Login Link:",e+"?"+l),console.log("Redirect URI used:",a.redirect_uri),e+"?"+l}}p.TWITCH_LOGIN_LINK="https://id.twitch.tv/oauth2/authorize",p.LOCALREDIRECT=d,p.TWITCH_GETUSER_LINK="https://api.twitch.tv/helix/users";a(41);function g({clipdata:e}){return s.a.createElement("div",{className:"clip"},s.a.createElement("a",{href:e.url},s.a.createElement("img",{alt:e.title,src:e.thumbnail_url}),s.a.createElement("div",{className:"cliptitle"},s.a.createElement("strong",null,e.title))),s.a.createElement("div",null,e.broadcaster_name),s.a.createElement("div",null,"Clipped by ",e.creator_name),s.a.createElement("div",null,e.view_count," views"))}class m extends s.a.Component{constructor(e){super(e),this.state={dateRange:e.dateRange},this.handleChange=this.handleChange.bind(this),this.onChange=e.onChange}handleChange(e){this.setState({dateRange:e.target.value}),this.onChange(e.target.value)}render(){return s.a.createElement("label",null,"Filter by:",s.a.createElement("select",{value:this.state.dateRange,onChange:this.handleChange},s.a.createElement("option",{value:"1"},"24H"),s.a.createElement("option",{value:"7"},"7D"),s.a.createElement("option",{value:"30"},"30D"),s.a.createElement("option",{value:"0"},"All")))}}class w extends s.a.Component{constructor(e){super(e),this.renderClips=async e=>{let t=!1,a=null,l=null,i=null;const{cookies:n}=this.props;if(null!==this.state.api)try{let s=new Date;s.setHours(s.getHours()-1);let r=this.state["clipexpire"+e];if(null!=r&&r>s)a=this.state["clipdatas"+e],t=!0;else{let t=null;if(void 0!==n.get("userId"))t=n.get("userId");else{if(l=await this.state.api.getUser(),200!==l.status)return void this.resetToLogin();t=l.data.data[0].id,n.set("userId",t,{secure:!0,sameSite:"strict"})}if(i=await this.state.api.getFollows(t),200!==i.status)return void this.resetToLogin();a=await this.state.api.getAllClips(i.data.data,parseInt(e))}}catch(c){console.log(c)}console.debug(a);let r=[],o=[];if(null===a)o.push(s.a.createElement("a",{key:"loginlink",href:p.getLoginLink()},"Login to Twitch to see Clips")),this.setState({clips:o});else{if(t)for(let e of a)r.push(e);else for(let e of a)if("fulfilled"===e.status)for(let t of e.value.data.data)r.push(t);else console.error(e.reason);r.sort((e,t)=>t.view_count-e.view_count),0===r.length&&o.push(s.a.createElement("div",null,"There are no clips from your follows that meet the specified criteria."));for(let e of r)o.push(s.a.createElement(g,{key:e.id,clipdata:e}));let l={clips:o};t||(l["clipdatas"+e]=r,l["clipexpire"+e]=Date.now()),this.setState(l)}};let t=null,a=null;if(""!==document.location.hash){let e=o.a.parse(document.location.hash),l=sessionStorage.getItem("state");e.state===l?(t=e.access_token,a=new p(t),sessionStorage.removeItem("state")):console.error("State does not match!")}this.state={clips:[s.a.createElement("div",null,"Loading clips...please wait")],api:a,dateRange:1,clipdatas0:null,clipdatas1:null,clipdatas7:null,clipdatas30:null,clipexpire0:null,clipexpire1:null,clipexpire7:null,clipexpire30:null},this.handleDateChange=this.handleDateChange.bind(this)}resetToLogin(){let e=[s.a.createElement("a",{key:"loginlink",href:p.getLoginLink()},"Login to Twitch to see Clips")];this.setState({clips:e})}handleDateChange(e){let t={dateRange:e,clips:[s.a.createElement("div",null,"Loading clips...please wait")]};this.setState(t),this.renderClips(e)}componentDidMount(){this.renderClips(1)}render(){return s.a.createElement("div",null,s.a.createElement("div",null,s.a.createElement(m,{dateRange:this.state.dateRange,onChange:this.handleDateChange})),s.a.createElement("div",{className:"clipOuterDiv"},this.state.clips))}}var f=Object(c.a)(w);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));n.a.render(s.a.createElement(s.a.StrictMode,null,s.a.createElement(f,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(e=>{e.unregister()}).catch(e=>{console.error(e.message)})}},[[15,1,2]]]);
//# sourceMappingURL=main.9f150967.chunk.js.map